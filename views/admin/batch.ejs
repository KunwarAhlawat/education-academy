<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap demo</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">


  <!-- Option 1: Include in HTML -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.css">
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
  <link href="/assets/admin-panel/css/app.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div class="wrapper">
		<%- include('partials/sidebar.ejs')%>

		<div class="main">
			<%- include('partials/nav.ejs')%>
    
      <main class="content">
            <!-- batch detail area -->
            <section class="form-area">
                <div class="row">
                    <div class="col-12">
                        <div class="form-header">
                            <div class="form-title">
                                <h2>Batches Detail</h2>
                                <!-- <p>Make Sure cross check all Details carefully Before Press Add Button</p> -->
                            </div>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                data-bs-target="#add_batch">Add Batch</button>
                        </div>
                    </div>
                    <div class="col-12">
                        <!--  batch table -->
              
                        <table id="myTable" class="table table-striped table-hover "></table></div>
                    </div>
                    <!-- add course  modal -->
                    <div class="modal" id="add_batch">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <!-- Modal Header -->
                                <div class="modal-header">
                                    <h4 class="modal-title">Add Batch</h4>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <!-- Modal Body -->
                                <div class="modal-body">
                                    <!-- add batch form modal -->
                                    <div class="col-12">
                                        <form id="addBatch" class="custom-form">
                                            <!-- form main area -->
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <div class="form-main">
                                                        <!-- course title  -->
                                                        <div class="mb-3">
                                                            <label for="batch_title" class="form-label">Add Batch
                                                                Title</label>
                                                            <input type="text" class="form-control" id="batch_title"
                                                                name="batch_title" required>
                                                        </div>
                                                        <!-- course description  -->
                                                        <div class="mb-3">
                                                            <label for="description" class="form-label">Description</label>
                                                            <input type="text" class="form-control" id="description"
                                                                name="description" required>
                                                        </div>
                                                        <!-- start date and time -->
                                                        <div class="d-flex">
                                                            <div class="mb-3">
                                                                <label for="startDate" class="form-label">Start
                                                                    Date</label>
                                                                <input type="date" class="form-control"
                                                                    id="startDate" name="startDate" required>
                                                            </div>
                                                            <div class="mb-3 ms-5">
                                                                <label for="startTime" class="form-label">Start
                                                                    Time</label>
                                                                <input type="time" class="form-control"
                                                                    id="startTime" name="startTime" required>
                                                            </div>
                                                        </div>
                                                        <!-- end date and time -->
                                                        <div class="d-flex">
                                                            <div class="mb-3">
                                                                <label for="endDate" class="form-label">End
                                                                    Date</label>
                                                                <input type="date" class="form-control"
                                                                    id="endDate" name="endDate" required>
                                                            </div>
                                                            <div class="mb-3 ms-5">
                                                                <label for="endTime" class="form-label">End
                                                                    Time</label>
                                                                <input type="time" class="form-control"
                                                                    id="endTime" name="endTime" required>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- form side bar area -->
                                                <div class="col-md-4">
                                                    <div class="form-sidebar">
                                                        <!-- select mode -->
                                                        <div class="mb-3">
                                                            <label class="form-label">Select Mode</label>
                                                            <div class="d-flex">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio"
                                                                        name="mode" id="onlineMode" value="Online"
                                                                        checked>
                                                                    <label class="form-check-label"
                                                                        for="onlineMode">Online</label>
                                                                </div>
                                                                <div class="form-check ms-3">
                                                                    <input class="form-check-input" type="radio"
                                                                        name="mode" id="offlineMode"
                                                                        value="Offline">
                                                                    <label class="form-check-label"
                                                                        for="offlineMode">Offline</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- no of Student Include -->
                                                        <div class="mb-3">
                                                            <label for="student-count" class="form-label">Total
                                                                Lectures *</label>
                                                            <input type="number" class="form-control"
                                                                id="student-count" name="totalLectures" required>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- submit -->
                                            <button type="submit" class="btn btn-primary">Submit</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
               
            </section>
          </main>
        </div>  
         
      </div>


  <!-- modal s -->
  <!-- edit modal -->
  <div class="modal" id="edit_batch">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Edit Batch</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">

          <!-- add batch form modal -->
          <div class="col-12">


            <form id="editBatchForm" class="custom-form">
              <!-- form main area -->
              <div class="row">
                <div class="col-md-8">
                  <div class="form-main">
                      <!-- course title  -->
                      <div class="mb-3">
                        <label for="id" class="form-label"> ID</label>
                        <input type="text" class="form-control" id="id" name="id" required>
                      </div>

                    <!-- course title  -->
                    <div class="mb-3">
                      <label for="name1" class="form-label">Add Batch Title</label>
                      <input type="text" class="form-control" id="name1" name="title" required>
                    </div>
                    <!-- course title  -->
                    <div class="mb-3">
                      <label for="description1" class="form-label">Description</label>
                      <input type="text" class="form-control" id="description" name="description1" required>
                    </div>

                   

                    <!-- start date -->
                    <div class="d-flex  ">
                      <div class="mb-3">
                        <label for="startDate1" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="startDate1" name="startDate" required>
                      </div>

                      <!-- start time -->
                      <div class="mb-3 ms-5">
                        <label for="startTime1" class="form-label">Start Time</label>
                        <input type="time" class="form-control" id="startTime1" name="startTime" required>
                      </div>
                    </div>

                    <div class="d-flex ">
                      <!-- end date -->
                      <div class="mb-3">
                        <label for="endDate1" class="form-label">End Date</label>
                        <input type="date" class="form-control" id="endDate1" name="endDate" required>
                      </div>

                      <!-- end time -->
                      <div class="mb-3 ms-5">
                        <label for="endTime1" class="form-label">End Time</label>
                        <input type="time" class="form-control" id="endTime1" name="endTime" required>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- form side bar area -->
                <div class="col-md-4">
                  <div class="form-sidebar">

                    <!-- select mode -->
                    <div class="mb-3">
                      <label class="form-label">Select Mode</label>
                      <div class="d-flex">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="mode1" id="onlineMode1" value="Online"
                             >
                          <label class="form-check-label" for="onlineMode1">
                            Online
                          </label>
                        </div>
                        <div class="form-check ms-3">
                          <input class="form-check-input" type="radio" name="mode1" id="offlineMode1" value="Offline">
                          <label class="form-check-label" for="offlineMode1">
                            Offline
                          </label>
                        </div>
                      </div>
                    </div>

                  <!-- no of Student Include -->
                  <div class="mb-3">
                    <label for="totalLectures1" class="form-label" aria-required="">Total Lectures </label>
                    <input type="number" class="form-control" id="totalLectures1" name="totalLectures" required>
                  </div>


                  </div>

                </div>
              </div>


              <!-- submit -->
              <button type="submit" class="btn btn-primary">submit</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>



  <script src="/assets/admin-panel/js/app.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Include DataTables -->
  <script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.2.3/js/dataTables.fixedHeader.min.js"></script>
  <script src="https://cdn.datatables.net/select/1.7.0/js/dataTables.select.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"
    integrity="sha512-hUhvpC5f8cgc04OZb55j0KNGh4eh7dLxd/dPSJ5VyzqDWxsayYbojWyl5Tkcgrmb/RVKCRJI1jNlRbVP4WWC4w=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment-with-locales.min.js"
    integrity="sha512-4F1cxYdMiAW98oomSLaygEwmCnIP38pb4Kx70yQYqRwLVCs3DbRumfBq82T08g/4LJ/smbFGFpmeFlQgoDccgg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>

  <script>
    // delte course table  
    async function deleteCourse(id) {
      const confirmed = await Swal.fire({
        title: 'Are you sure?',
        text: 'You will not be able to recover this course!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
      });

      if (confirmed.isConfirmed) {
        try {
          const response = await $.ajax({
            url: `/admin/batch_delete/${id}`,
            type: 'DELETE'
          });

          console.log('Batch Data:', response);

          await Swal.fire({
            title: 'Deleted!',
            text: 'The Batch has been deleted.',
            icon: 'success'
          });

          // Reload the page after a successful request
          window.location.reload();
        } catch (error) {
          console.error('Error:', error);

          await Swal.fire({
            title: 'Error!',
            text: 'An error occurred while deleting the Batch.',
            icon: 'error'
          });
        }
      }
    }


    //  edit course table
    function editBatch(id) {
      // Ajax request to fetch course data
      $.ajax({
        url: `/admin/batch/${id}`, // Assuming this route exists on your server
        type: "GET",
        success: function (data, status) {
          console.log("Course Data:", data);

          const form = document.getElementById("editBatchForm")
          
          // set  data for specif form 
          $('[name="id"]', form).val(data.id);

          $('[name="title"]', form).val(data.title);
          $('[name="startTime"]', form).val(data.startTime);
          let startDate = new Date(data.startDate);
          let formattedStartDate = startDate.toISOString().split('T')[0];

          $('[name="startDate"]', form).val(formattedStartDate);
           if (data.mode === 'Online') {
              $('#onlineMode1').prop('checked', true);
          } else if (data.mode === 'Offline') {
              
              $("#offlineMode1").prop("checked", true);

          }
          $('[name="endTime"]', form).val(data.endTime);

          let endDate = new Date(data.endDate);
          let formattedendDate = endDate.toISOString().split('T')[0];

          $('[name="endDate"]', form).val(formattedendDate);
          $('[name="description"]', form).val(data.description);
          $('[name="totalLectures"]', form).val(data.totalLectures);
          

          const myModal = new bootstrap.Modal(document.getElementById('edit_batch'));
          myModal.show();

        },
        error: function (error) {
          console.log(error)
        }
      })

    }

 
  </script>
  <script>
    $(document).ready(function () {

      // table
      $.ajax({
        url: '/admin/all_batches',
        method: 'GET',
        success: function (data) {
          // Initialize DataTables only after successful data retrieval
          console.log("Data", data)
          $('#myTable').DataTable({
            data: data,
            columns: [
              { data: 'id', title: 'Batch ID' },
              { data: 'title', title: 'Title' },
              { data: 'mode', title: 'Mode' },
              { data: 'totalLectures', title: 'Total Lectures' },
              { data: 'startTime', title: 'Start Time' },
              { data: 'endTime', title: 'End Time' },
              { data: 'startDate', title: 'Start Date' },
              { data: 'endDate', title: 'End Date' },
              { data: 'description', title: 'Description' },
              { data: 'createdAt', title: 'CreatedAt' },
              { data: 'updatedAt', title: 'UpdatedAt' },
              {
                data: null,
                title: 'Actions',
                render: function (data, type, row) {
                  // Customize this part to add edit and delete buttons
                  return '<button onclick="editBatch(\'' + data.id + '\')"   class="btn btn-primary">Edit</button> <button onclick="deleteCourse(\'' + data.id + '\')" class="btn btn-danger delete-btn">Delete</button>';
                  // return `<button onclick="createModal('${encodeURIComponent(JSON.stringify(data))}')" class="btn btn-primary">Edit</button> <button class="btn btn-danger delete-btn">Delete</button>`;
                  // return '<button onclick="createModal(' + JSON.stringify(data) + ')" class="btn btn-primary">Edit</button> <button class="btn btn-danger delete-btn">Delete</button>';

                }
              }
              // Add more columns as needed
            ]
          });
        },
        error: function (error) {
          console.error('Error fetching data:', error);
        }
      });

    



      // form create modal 
      $("#addBatch").validate({
        submitHandler: async function (form, event) {
          event.preventDefault();

          let form_data = $("#addBatch").serialize();

          // console.log("formdata", form_data);

          try {
            const response = await $.ajax({
              url: '/admin/batch',
              type: 'POST',
              data: form_data,
              contentType: "application/x-www-form-urlencoded",
            });

            // If the request is successful, show a success message
            await Swal.fire({
              title: 'Success',
              text: 'Batch added successfully!',
              icon: 'success',
            });

            // You can perform additional actions here if needed
            window.location.reload();
            console.log('Success:', response);
          } catch (error) {
            // If the request fails, show an error message
            await Swal.fire({
              title: 'Error',
              text: 'An error occurred while adding the course.',
              icon: 'error',
            });

            console.error('Error:', error);
          }
        }
      });
  
  
  


    // edit batch
     // form create modal 
     $("#editBatchForm").validate({
        submitHandler: async function (form, event) {
          event.preventDefault();

          // Serialize the form data excluding the 'mode' input
          let form_data = $("#editBatchForm :input[name!='mode']").serialize();

          // Get the checked value of the 'mode' input
           let mode1 = $("#editBatchForm :input[name='mode1']:checked").val();
         
          let mode = $('#editBatchForm').find(':input[name="mode1"]:checked').val();

       
          // Append the 'mode' value to the serialized data
          form_data += `&mode=${mode}`;

          // Get the 'id' value
          let id = $('[name="id"]', form).val();
          console.log("formData", form_data);

        
      
           
             try {
              const response = await $.ajax({
                url: `/admin/batch_update/${id}`,
                type: 'put',
                data: form_data,
                contentType: "application/x-www-form-urlencoded",

              });

              // Course found and updated successfully
              Swal.fire({
                title: 'Success',
                text: 'Batch updated successfully!',
                icon: 'success',
                confirmButtonText: 'OK'
              }).then(() => {
                window.location.reload();
              });
            } catch (error) {
              console.error('Error:', error);

              // Handle different error scenarios
              if (error.responseJSON && error.responseJSON.error === 'Batch not found.') {
                // Batch not found
                Swal.fire({
                  title: 'Error',
                  text: 'Batch not found.',
                  icon: 'error',
                  confirmButtonText: 'OK'
                });
              } else {
                // Other unexpected errors
                Swal.fire({
                  title: 'Error',
                  text: 'An error occurred while updating the Batch.',
                  icon: 'error',
                  confirmButtonText: 'OK'
                });
              }
            }
        }
      });
    })
  </script>
</body>

</html>