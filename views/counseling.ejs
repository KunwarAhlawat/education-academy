<%- include('partials/header') %>
  <!-- counseling hero section start -->
  <section class="counseling-area section-padding">
    <div class="container">
    
        <div class="row">
          <div class="col">
            <div class="counseling-course-info">
             <ul>
              <li><h2><%= courseViewData.title %></h2></li>
              <li><Strong>Duration -</Strong> <%= courseViewData.duration %></li>
              <!-- <li><%= courseViewData.discountText %></li> -->
              <li><strong>Course Price -</strong><span><%= courseViewData.price.discountedPrice %></span> 
                <span><%= courseViewData.price.regularPrice %></span>
                <span><%= courseViewData.price.discountPercentage %></span>
              </li>
             </ul>
            </div>
          </div>
        </div>

        <!-- form area start -->
         <div class="row">
          <div class="col">
            <form class="counselling-form" autocomplete="on" id="counselling-form">
              <!-- personal details area start -->
              <div class="row">
                  <div class="col">
                      <h4>Please take a moment to fill out this form accurately.</h4>
                      <hr>
                  </div>
              </div>
              
              <!-- first and last name area -->
              <div class="row">
                  <div class="col-md-6">
                    <div class="form-field">
                      <div class="filedForm">
                          <label for="FirstName">First Name</label> <br />
                          <input id="FirstName" name="firstName" class="form-control" placeholder="Insert your First Name"
                              type="text" autocomplete="given-name">
                      </div>
                    </div>  
                  </div>

                  <div class="col-md-6 mt-3 mt-md-0">
                    <div class="form-field">
                      <div class="LastName">
                          <label for="LastName">Last Name</label> <br />
                          <input id="LastName" name="lastName" class="form-control" placeholder="Insert your Last Name"
                              type="text" autocomplete="family-name">
                      </div>
                    </div>
                  </div>
               
              </div>

              <!-- mobile no , email and dob area -->
              <div class="row">
                  <div class="col-md-6 mt-3 mt-md-0">
                    <div class="form-field">
                      <label for="mobileNo">Mobile No</label> <br>
                      <input id="mobileNo" name="mobileNo" class="form-control" placeholder="Insert your Mobile Number"
                          type="tel" autocomplete="tel">
                    </div>
                  </div>
                  <div class="col-md-6 mt-3 mt-md-0">
                    <div class="form-field">
                      <label for="email">Email</label> <br>
                      <input id="email" name="email" class="form-control" type="email" placeholder="Insert your Email"
                          autocomplete="email">
                    </div>
                  </div>
                  <div class="col-md-6 mt-3 mt-md-0">
                    <div class="form-field">
                      <label for="Dob">DOB</label> <br>
                      <input id="Dob" name="dateOfBirth" class="form-control" type="date"
                          placeholder="Select DOB" autocomplete="bday">
                  </div>
              </div>

              <!-- gender and need hostel area -->
              <div class="row ">
                
                  <div class="col-md-6 mt-3 mt-md-0" >
                    <div class="form-field">
                      <div id="gender" class="gender">
                          <label for="sex">Sex :</label>
                          <ul>
                              <li>
                                  <input name="gender" id="male" type="radio" value="Male">
                                  <label for="male">Male</label>
                              </li>
                              <li>
                                  <input name="gender" id="Female" type="radio" value="Female">
                                  <label for="Female">Female</label>
                              </li>
                          </ul>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 mt-3 mt-md-0">
                  <div class="form-field">
                      <div id="hostel" class="gender">
                          <label for="hostel">Hostel :</label>
                          <ul>
                              <li>
                                  <input name="hostel" id="yes" type="radio" value="yes">
                                  <label for="yes">Yes</label>
                              </li>
                              <li>
                                  <input name="hostel" id="no" type="radio" value="no">
                                  <label for="no">No</label>
                              </li>
                          </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- father and monter name area -->
              <div class="row">
      
                  <div class="col-md-6">
                    <div class="form-field">
                      <label for="fatherName">Father's Name :</label> <br>
                      <input id="fatherName" name="fatherName" class="form-control"
                          placeholder="Enter Father's Name" type="text">
                    </div>
                </div>

                  <div class="col-md-6">
                    <div class="form-field">
                      <label for="motherName">Mother's Name :</label> <br>
                      <input id="motherName" name="motherName" class="form-control"
                          placeholder="Enter Mother's Name" type="text">
                  </div>
                </div>
              </div>

              <!-- blood group and parent number area -->
              <div class="row">
                  <div class="col-md-6">
                    <div class="form-field">
                      <label for="bloodGroup">Blood Group</label> <br>
                      <select id="bloodGroup" name="bloodGroup" class="form-select">
                          <option value="A+">A+</option>
                          <option value="A-">A-</option>
                          <option value="B+">B+</option>
                          <option value="B-">B-</option>
                          <option value="AB+">AB+</option>
                          <option value="AB-">AB-</option>
                          <option value="O+">O+</option>
                          <option value="O-">O-</option>
                      </select>
                  </div>
                </div>

                  <div class="col-md-6">
                    <div class="form-field">
                    <label for="parentNo">Parent's No :</label> <br>
                    <input id="parentNo" name="parentNo" class="form-control" placeholder="Enter Parent's No" type="tel" autocomplete="tel">
                  </div>
                </div>
              </div>
              </div>

              <!-- address area -->
              <div class="row">
                <div class="form-field">
                  <div class="col-md-6">
                      <label for="permanentAddress">Permanent Address</label> <br>
                      <textarea id="permanentAddress" name="permanentAddress" class="form-control"
                          placeholder="Enter Address" rows="4" cols="50"></textarea>
                  </div>
                </div>
              </div>
              <!-- personal details area end -->
            
            
            <!-- local guardian area srart -->
              <div class="row formField">
                  <div class="col">
                      <h4>Local Guardian :-</h4>
                      <hr>
                  </div>
              </div>

              <div class="row formField">
                  <div class="col-md-6">
                      <label for="guardian">Guardian Name :</label> <br>
                      <input id="guardian" name="guardian" class="form-control"
                          placeholder="Enter Guardian Name" type="text">
                  </div>
                  <div class="col-md-6">
                      <label for="relationship">Relationship :</label> <br>
                      <input id="relationship" name="relationship" class="form-control"
                          placeholder="Enter Relationship" type="text">
                  </div>
              </div>

              <div class="row formField">
                  <div class="col-md-6">
                      <label for="guardianMobile">Mobile :</label> <br>
                      <input id="guardianMobile" name="guardianMobile" class="form-control"
                          placeholder="Enter Mobile" type="tel">
                  </div>
                  <div class="col-md-6">
                      <label for="guardianAddress">Address :</label> <br>
                      <input id="guardianAddress" name="guardianAddress" class="form-control"
                          placeholder="Enter Address" type="text">
                  </div>
              </div>
             <!-- local guardian area end
             -->
            
              <div class="row formField">
                  <div class="col">
                      <h4>Academic Profile :-</h4>
                      <hr>
                  </div>
              </div>

              <div class="row formField">
                  <div class="col-md-6">
                      <label for="programApplied">Program Applied For :</label> <br>
                      <input id="programApplied" name="programApplied" class="form-control"
                          placeholder="Enter Program" type="text">
                  </div>

                  <div class="col-md-6">
                      <label for="entranceApplied">Entrance Exam Date :</label> <br>
                      <input id="entranceApplied" name="entranceApplied" class="form-control" type="date">
                  </div>
              </div>

              <div class="row formField">
                  <div class="col-md-6">
                      <label for="subjectApplied">Subject Applied For :</label> <br>
                      <input id="subjectApplied" name="subjectApplied" class="form-control"
                          placeholder="Enter Subjects" type="text">
                  </div>

                  <div class="col-md-6">
                      <label for="reference">Reference :</label> <br>
                      <input id="reference" name="reference" class="form-control"
                          placeholder="Enter Reference" type="text">
                  </div>
              </div>

              <div class="row formField">
                  <div class="col-md-6">
                      <label for="submitDate">Date :</label> <br>
                      <input id="submitDate" name="submitDate" class="form-control" type="date">
                  </div>
              </div>

              <div class="row mt-3 ">
                  <div id="declaration" class="col-12 d-flex align-items-start ">
                      <input class="mt-2" name="declaration" type="checkbox">
                      <p class="semibold ms-3 "><strong>Deceleration:</strong> By submitting this form, I
                          declare that the provided information is accurate and has been provided by me.</p>
                  </div>
              </div>

              <div class="row mt-4 ">
                  <div class="col-12">
                      <button type="submit" class="btn btn-primary">Pay Now</button>
                  </div>
              </div>
          </form>
          </div>
         </div>
        <!-- form area end -->
    </div>
  </section>

  <script src="/assets/vendor/js/jquery-3.7.1.min.js"></script>

  <script src="/assets/vendor/js/bootstrap.bundle.min.js"></script>
  <script src="/assets/vendor/js/owl.carousel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollToPlugin.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"
    integrity="sha512-GWzVrcGlo0TxTRvz9ttioyYJ+Wwk9Ck0G81D+eO63BaqHaJ3YZX9wuqjwgfcV/MrB2PhaVX9DkYVhbFpStnqpQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>



  <script>
    const validationData = "../middlewares/counselling/clientValidation.js"
    $(document).ready(function () {
      // Custom email validation using regex
      $.validator.addMethod("customEmail", function (value, element) {
        // Modify the regular expression according to your needs
        return this.optional(element) || /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(value);
      }, "Please enter a valid email address");

      $("#counselling-form").validate({
        rules: {
          firstName: {
            required: true,
            minlength: 2, // Minimum length of 2 characters
            maxlength: 50, // Maximum length of 50 characters
          },
          lastName: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          email: {
            required: true,
            customEmail: true
          },
          mobileNo: {
            required: true,
            number: true,
            minlength: 10,
            maxlength: 10,
          },
          dateOfBirth: {
            required: true,
            date: true,
          },
          gender: "required",
          hostel: "required",
          fatherName: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          motherName: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          bloodGroup: "required",
          parentNo: {
            required: true,
            number: true,
            minlength: 10,
            maxlength: 10,
          },
          permanentAddress: "required",
          guardian: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          relationship: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          guardianMobile: {
            required: true,
            number: true,
            minlength: 10,
            maxlength: 10,
          },
          guardianAddress: "required",
          programApplied: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          entranceApplied: "required",
          subjectApplied: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          reference: {
            required: true,
            minlength: 2,
            maxlength: 50,
          },
          submitDate: "required",
          declaration: "required",
        },
        messages: {
          firstName: {
            required: "Please enter your first name",
            minlength: "First name must be at least 2 characters",
            maxlength: "First name must not exceed 50 characters",
          },
          lastName: {
            required: "Please enter your last name",
            minlength: "Last name must be at least 2 characters",
            maxlength: "Last name must not exceed 50 characters",
          },
          email: {
            required: "Please enter your email address"
          },
          mobileNo: {
            required: "Please enter your mobile number",
            number: "Please enter a valid number",
            minlength: "Mobile number must be 10 digits",
            maxlength: "Mobile number must be 10 digits",
          },
          dateOfBirth: {
            required: "Please enter your date of birth",
            date: "Please enter a valid date",
          },
          gender: "Please select your gender",
          hostel: "Please select whether you need hostel accommodation",
          fatherName: {
            required: "Please enter your father's name",
            minlength: "Father's name must be at least 2 characters",
            maxlength: "Father's name must not exceed 50 characters",
          },
          motherName: {
            required: "Please enter your mother's name",
            minlength: "Mother's name must be at least 2 characters",
            maxlength: "Mother's name must not exceed 50 characters",
          },
          bloodGroup: "Please select your blood group",
          parentNo: {
            required: "Please enter your parent's mobile number",
            number: "Please enter a valid number",
            minlength: "Parent's mobile number must be 10 digits",
            maxlength: "Parent's mobile number must be 10 digits",
          },
          permanentAddress: "Please enter your permanent address",
          guardian: {
            required: "Please enter your guardian's name",
            minlength: "Guardian's name must be at least 2 characters",
            maxlength: "Guardian's name must not exceed 50 characters",
          },
          relationship: {
            required: "Please enter your relationship with the guardian",
            minlength: "Relationship must be at least 2 characters",
            maxlength: "Relationship must not exceed 50 characters",
          },
          guardianMobile: {
            required: "Please enter your guardian's mobile number",
            number: "Please enter a valid number",
            minlength: "Guardian's mobile number must be 10 digits",
            maxlength: "Guardian's mobile number must be 10 digits",
          },
          guardianAddress: "Please enter your guardian's address",
          programApplied: {
            required: "Please enter the program you are applying for",
            minlength: "Program name must be at least 2 characters",
            maxlength: "Program name must not exceed 50 characters",
          },
          entranceApplied: "Please enter the entrance exam date",
          subjectApplied: {
            required: "Please enter the subjects you are applying for",
            minlength: "Subjects must be at least 2 characters",
            maxlength: "Subjects must not exceed 50 characters",
          },
          reference: {
            required: "Please enter the reference information",
            minlength: "Reference must be at least 2 characters",
            maxlength: "Reference must not exceed 50 characters",
          },
          submitDate: "Please enter the submission date",
          declaration: "Please agree to the declaration",
        },

        errorPlacement: function (error, element) {
          // Check if error message has already been displayed for this field
          if (!element.data('error-shown')) {
            // Set a data attribute to mark that the error message has been displayed
            element.data('error-shown', true);

            // Customize error placement if needed
            // Custom position: gender
            if (element.attr("name") === "gender") {
              $("#gender").after('<div class="error-message fs-4 fw">' + error.text() + '</div>');
            }
            // Custom position: hostel
            else if (element.attr("name") === "hostel") {
              $("#hostel").after('<div class="error-message fs-4 fw">' + error.text() + '</div>');
            }
            // Custom position: declaration
            else if (element.attr("name") === "declaration") {
              $("#declaration").after('<div class="error-message fs-4 fw">' + error.text() + '</div>');
            }
            // Default position: if no match is met (other fields)
            else {
              $('<div class="error-message fs-4 fw">' + error.text() + '</div>').insertAfter(element);
            }
          }
        },

        submitHandler: function (form, event) {
          alert("hi")
          event.preventDefault()
          // console.log($(form).serialize())
          $.ajax({
            type: "POST",
            url: "/counselling",
            data: $(form).serialize(),
            success: function (data, status) {
              console.log("DataReturn:", data);
              console.log("Status:", status);

              // Remove previous error messages
              $('.error-message').remove();
              $('.success').remove();

              if (data.errors) {
                data.errors.forEach(err => {
                  var inputName = err.path;
                  var errorMessage = err.msg;
                  $('[name="' + inputName + '"]').after('<div class="error-message">' + errorMessage + '</div>');
                });
              }

              if (data.msg && status === "success") {
                const message = data.msg;

                // Check for specific messages related to email and phone duplication
                if (message === "Email already exists") {
                  $('#addCounsellingForm').append('<div class="error-message fs-4 fw-bold">' + message + '</div>');
                } else if (message === "Mobile number already exists") {
                  $('#addCounsellingForm').append('<div class="error-message fs-4 fw-bold">' + message + '</div>');
                } else if (message === "Email and Mobile number already exist") {
                  // Handle the case where both email and mobile are duplicated
                  $('#addCounsellingForm').append('<div class="error-message fs-4 fw-bold">' + message + '</div>');
                } else {
                  // Display success message for other cases
                  $('#addCounsellingForm').append('<h4 class="success">' + message + '</h4>');
                }
              }
            },
            error: function (xhr, status, error) {
              console.error("Error:", error);
            }
          });

        }
      });

    });


  </script>

  </body>

  </html>